<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.devpl.auth.mapper.IdentityMapper">

    <resultMap id="identityMap" type="io.devpl.auth.domain.Identity">
        <result column="identity_code" property="identityCode"/>
        <result column="identity_name" property="identityName"/>
        <result column="icon_url" property="iconUrl"/>
        <result column="is_present" property="present"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <select id="listIdentityByUserId" resultMap="identityMap">
        SELECT i.identity_code, i.identity_name, i.icon_url, i.is_present, ui.create_time, ui.update_time
        FROM identity AS i,
             user_identity AS ui
        WHERE ui.identity_code = i.identity_code
          AND ui.user_id = #{userId}
    </select>

    <insert id="setIdentity">
        INSERT INTO user_identity(user_id, identity_code, create_time, update_time)
        VALUES (#{userId}, #{identityCode}, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
    </insert>

    <select id="listByCondition" resultMap="identityMap">
        SELECT identity_code, identity_name, icon_url, is_present, create_time, update_time
        FROM identity
    </select>
</mapper>
